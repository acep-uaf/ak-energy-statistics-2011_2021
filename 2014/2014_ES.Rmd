---
output: html_document
editor_options: 
  chunk_output_type: console
---


```{R}
library(readxl)
library(readr)

```

```{R}



# point towards directory
# point towards workbook THIS WILL CHANGE SOON!
drive <- "~/Desktop/energy_stats/"
setwd(drive)
workbook <- "~/Desktop/energy_stats/2014/2014 AK Energy Statistics early release.xlsx"

# Read sheets and use for filenames
sheets <- excel_sheets(workbook)
filenames <- paste0(sheets, ".csv")

# read_excel only reads a single sheet, so lapply over each sheet name
dat <- lapply(sheets, read_excel, path = workbook)

# point towards location to save raw CSV files (sheets)
save_raw <- "~/repos/ak-energy-statistics-2011_2021/2014/raw/"
setwd(save_raw)

# I dream of idempotency..
# Save each data frame with different filename using write_csv
lapply(seq_along(dat), function(i) write_csv(dat[[i]], filenames[i]))




```


```{R}
setwd(save_raw)

i <- NULL
df <- NULL

for(i in filenames){
  assign(gsub(".csv", "", paste(i)), read.csv(paste(i)))
}






```


set target for cleaned files
**VERY IMPORTANT**
```{R}
save_staging <- "~/repos/ak-energy-statistics-2011_2021/2014/staging/"
setwd(save_staging)




```





# TEMPLATE! COPY, DONT CHANGE
## table   
### 
```{R}
# # save title
# title_ <- `Table `[1,1]
# print(title_)
# 
# # save column names
# # watch out! different than others
# colnames(`Table `) <- `Table `[2, ]
# 
# # delete first row (title), and third row (column names)
# `Table ` <- `Table `[-c(1,2), ]

```




# Tables 2.5x below

## table 2.5a
### "Table 2.5a Revenue, Sales and Customers by Customer Type by Operators/Utilities ($000, MWh, Accounts), 2021"
```{R}
# extract title, use for idempotency below
title_2.5a <- `Table 2.5a`[1,1]
print(title_2.5a)

# use table title as qualifyer for cleaning expression
if(`Table 2.5a`[1,1] == "Table 2.5a Revenue, Sales and Customers by Customer Type by Operators/Utilities ($000, MWh, Accounts), 2014") {
  
  # save second row as column names
  colnames(`Table 2.5a`) <- `Table 2.5a`[2, ]
  
  # delete first row (title), second row (blank), and third row (column names)
  `Table 2.5a` <- `Table 2.5a`[-c(1:2), ]

}

setwd(save_staging)
write.csv(`Table 2.5a`, file = "./table_2.5a.csv")

```

## table 2.5b
### "Table 2.5b  Average Annual Energy Use and Rates by Customer Type by Operators/Utilities, (kWh/Customer, $/Customer, $/kWh), 2021"
```{R}
# save title, use to prevent repeat of cleaning expression
title_2.5b <- `Table 2.5b`[1,1]
print(title_2.5b)

if(`Table 2.5b`[1,1] == "Table 2.5b  Average Annual Energy Use and Rates by Customer Type by Operators/Utilities, (kWh/Customer, $/Customer, $/kWh), 2014"){
  # save second row as column names
  colnames(`Table 2.5b`) <- `Table 2.5b`[2, ]
  
  # delete first row (title), second row (blank) and third row (column names)
  `Table 2.5b` <- `Table 2.5b`[-c(1:2), ]

}

setwd(save_staging)
write.csv(`Table 2.5b`, file = "./table_2.5b.csv")

```


## table 2.5c
### "Table 2.5c  Average Residential Rates and PCE Payments ($/kWh), 2021"
```{R}
# save title
title_2.5c <- `Table 2.5c`[1,1]
print(title_2.5c)

if(`Table 2.5c`[1,1] == "Table 2.5c  Average Residential Rates and PCE Payments ($/kWh), 2014"){
  # save third row as column names
  colnames(`Table 2.5c`) <- `Table 2.5c`[2, ]
  
  # delete first row (title), second row (blank), and third row (column names)
  `Table 2.5c` <- `Table 2.5c`[-c(1:2), ]
}

setwd(save_staging)
write.csv(`Table 2.5c`, file = "./table_2.5c.csv")
  
```